<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>영상 목록 - KidsAni</title>

  <!-- CSP (프로젝트 공통) -->
  <meta http-equiv="Content-Security-Policy" content="
    default-src 'self';
    connect-src 'self' https://www.googleapis.com https://firestore.googleapis.com https://securetoken.googleapis.com https://identitytoolkit.googleapis.com https://firebaseinstallations.googleapis.com https://www.gstatic.com https://www.youtube.com;
    img-src 'self' data: https://i.ytimg.com https://img.youtube.com;
    frame-src https://www.youtube.com;
    script-src 'self' https://www.gstatic.com 'unsafe-inline';
    style-src 'self' 'unsafe-inline';
    object-src 'none';
    base-uri 'self';
  ">

  <link rel="stylesheet" href="css/style.css"/>
  <style>
    .page { max-width: 1080px; margin: 0 auto; padding: 8px; }
    .row { display: flex; gap: 8px; flex-wrap: wrap; align-items: center; }
    .grow { flex: 1; }
    .pill { border:1px solid var(--border,#333); border-radius:999px; padding:6px 10px; background:var(--bg-3,#1b1b1b); color:var(--fg,#fff); }
    .btn { border:1px solid var(--border,#333); background:#000; color:#fff; border-radius:10px; padding:6px 10px; cursor:pointer; }
    .btn:disabled { opacity:.6; cursor:not-allowed; }
    .btn-ghost { background:transparent; }
    .list-head { display:flex; align-items:center; justify-content:space-between; margin:8px 0 4px; }
    .list-head .title { font-weight:700; }
    .toolbar { display:grid; grid-template-columns: 1fr auto auto; gap:8px; align-items:center; margin:8px 0; }
    .item { display:grid; grid-template-columns:32px 1fr 220px; gap:10px; border:1px solid var(--border,#333); border-radius:12px; padding:10px; background:var(--bg-2,#111); margin:6px 0; }
    .col-check { display:flex; align-items:flex-start; padding-top:4px; }
    .col-main .title { font-weight:700; font-size:16px; line-height:1.3; }
    .col-main .url { font-size:12px; opacity:.8; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
    .chips { display:flex; flex-wrap:wrap; gap:6px; margin:3px 0; }
    .chip { border:1px solid var(--border,#333); border-radius:999px; padding:2px 8px; font-size:12px; opacity:.9; }
    .meta { display:flex; gap:8px; align-items:center; font-size:12px; opacity:.85; }
    .series-badge,.episode-badge { border:1px solid var(--border,#333); border-radius:999px; padding:1px 6px; }
    .col-side { display:grid; grid-template-rows:auto auto; gap:8px; align-items:center; justify-items:end; }
    .thumb { width:200px; aspect-ratio:16/9; object-fit:cover; border-radius:10px; border:1px solid var(--border,#333); }
    .actions { display:flex; gap:8px; flex-wrap:wrap; }
    #empty { text-align:center; opacity:.7; padding:24px 8px; }
    .banner { background:#2b2b2b; color:#fff; border:1px solid #444; border-radius:8px; padding:8px 10px; margin:8px 0; }
    .banner a { color:#9fd1ff; text-decoration:underline; }

    .bulk-row { display:flex; gap:8px; align-items:center; justify-content:flex-end; margin:6px 0; }
    .muted { opacity:.75; font-size:12px; }

    @media(max-width:720px){
      .item { grid-template-columns: 32px 1fr; }
      .col-side { justify-items:stretch; }
      .thumb { width:100%; }
      .actions .btn { flex:1; }
    }

    /* dialog */
    dialog::backdrop { background: rgba(0,0,0,.5); }
    dialog { border:1px solid var(--border,#333); border-radius:12px; padding:10px; background:var(--bg-2,#111); color:var(--fg,#fff); }
  </style>
</head>
<body>
  <!-- 상단바: 원본 유지 -->
  <header class="site-header">
    <img class="brand-logo" src="image/copytube_logo_side.png" alt="KidsAni">
    <div style="flex:1"></div>
    <nav class="top-nav">
      <a class="btn" href="index.html">카테고리</a>
      <a class="btn" href="watch.html">영상보기</a>
      <a class="btn" href="upload.html">등록</a>
      <a class="btn" href="manage-uploads.html">내영상관리</a>
    </nav>
  </header>

  <main class="page">
    <!-- 인덱스 에러 안내 배너 -->
    <div id="errorBanner" class="banner" style="display:none"></div>

    <!-- 상단 제목행 + 정렬 방향 토글 -->
    <div class="list-head">
      <div class="title">영상목록 — 제목</div>
      <button id="dirToggleBtn" class="btn" title="정렬 방향 토글(기본/거꾸로)">최신순</button>
    </div>

    <!-- 툴바 -->
    <div class="toolbar">
      <div class="row">
        <select id="catSelect" class="pill">
          <option value="">전체 카테고리</option>
          <!-- categories.js에서 채움 -->
        </select>
        <input id="keyword" class="pill" type="search" placeholder="제목 검색"/>
      </div>

      <!-- 시리즈 카테고리에서만 노출되는 정렬필드 3종 -->
      <div id="seriesSortFields" class="pill" style="display:none">
        <label><input type="radio" name="sortField" value="createdAt" checked> 등록순</label>
        <label><input type="radio" name="sortField" value="seriesSortAt"> 유튜브업로드순</label>
        <label><input type="radio" name="sortField" value="title"> 가나다</label>
      </div>

      <div class="row">
        <button id="refreshBtn" class="btn">새로고침</button>
        <button id="moreBtn" class="btn">더 보기</button>
      </div>
    </div>

    <!-- 일괄 액션 -->
    <div class="bulk-row">
      <span id="selCount" class="muted">선택 0</span>
      <button id="bulkChangeBtn" class="btn">선택 카테고리</button>
      <button id="bulkDeleteBtn" class="btn">선택 삭제</button>
    </div>

    <!-- (기존 select 정렬 호환: 없으면 JS에서 무시) -->
    <select id="sortSelect" hidden>
      <option value="createdAt_desc" selected>최신순</option>
      <option value="createdAt_asc">등록순</option>
      <option value="title_asc">가나다</option>
      <option value="seriesSortAt_desc">유튜브업로드순</option>
    </select>

    <section id="list"></section>
    <div id="empty" hidden>결과가 없습니다.</div>

    <!-- 무한 스크롤 sentinel -->
    <div id="sentinel" style="height:1px;"></div>
  </main>

  <!-- 카테고리 변경 모달 -->
  <dialog id="catDialog">
    <form method="dialog" id="catForm" style="min-width:280px; max-width:80vw;">
      <h3 style="margin:0 0 8px 0;">카테고리 변경</h3>
      <div id="catDialogBody" style="max-height:45vh; overflow:auto; padding-right:4px;"></div>
      <div style="display:flex; gap:8px; justify-content:flex-end; margin-top:12px;">
        <button value="cancel" class="btn">취소</button>
        <button id="catSaveBtn" value="default" class="btn">저장</button>
      </div>
    </form>
  </dialog>

  <!-- Firebase & App -->
  <script src="https://www.gstatic.com/firebasejs/10.13.0/firebase-app.js" type="module"></script>
  <script src="https://www.gstatic.com/firebasejs/10.13.0/firebase-auth.js" type="module"></script>
  <script src="https://www.gstatic.com/firebasejs/10.13.0/firebase-firestore.js" type="module"></script>

  <script type="module" src="js/firebase-init.js"></script>
  <script type="module" src="js/categories.js"></script>
  <script type="module" src="js/list.js?v=2.0.1" defer></script>
</body>
</html>
