<!-- upload.html (KidsAni v0.3.2) -->
<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>추천영상 등록 - KidsAni</title>

  <!-- (선택) YouTube Data API 키를 여기에 지정하면 시리즈의 유튜브 업로드시간을 정확히 반영합니다. -->
  <!-- <script>window.YT_API_KEY = "YOUR_YOUTUBE_API_KEY";</script> -->

  <!-- CSP -->
  <meta http-equiv="Content-Security-Policy" content="
    default-src 'self';
    connect-src 'self' https://www.googleapis.com https://firestore.googleapis.com https://securetoken.googleapis.com https://identitytoolkit.googleapis.com https://firebaseinstallations.googleapis.com https://www.gstatic.com https://www.youtube.com;
    img-src 'self' data: https://i.ytimg.com;
    frame-src https://www.youtube.com;
    script-src 'self' https://www.gstatic.com 'unsafe-inline';
    style-src 'self' 'unsafe-inline';
    object-src 'none';
    base-uri 'self';
  ">

  <link rel="stylesheet" href="css/style.css"/>

  <!-- ✅ 공통 헤드 스니펫: PWA Manifest / 파비콘 / 애플 아이콘 / iOS 메타 -->
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#000000">
  <link rel="icon" type="image/png" sizes="192x192" href="image/kidsani_logo_192r.png">
  <link rel="icon" type="image/png" sizes="512x512" href="image/kidsani_logo_512r.png">
  <link rel="apple-touch-icon" sizes="180x180" href="image/kidsani_logo_192r.png">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="apple-mobile-web-app-title" content="KidsAni">

  <!-- ✅ Open Graph / Twitter 미리보기 -->
  <meta property="og:title" content="추천영상 등록 - KidsAni" />
  <meta property="og:description" content="유튜브 URL을 붙여넣고 카테고리를 선택해 KidsAni에 영상을 추천 등록하세요." />
  <meta property="og:image" content="https://copytube.github.io/image/kidsani_logo_512r.png" />
  <meta property="og:url" content="https://copytube.github.io/upload.html" />
  <meta property="og:type" content="website" />
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="추천영상 등록 - KidsAni">
  <meta name="twitter:description" content="유튜브 URL을 붙여넣고 카테고리를 선택해 KidsAni에 영상을 추천 등록하세요.">
  <meta name="twitter:image" content="https://copytube.github.io/image/kidsani_logo_512r.png">

  <style>
    .controls-grid{
      display:grid;
      grid-template-columns: minmax(160px, 40%) 1fr 1fr;
      grid-template-rows: auto auto;
      gap:10px; align-items:stretch; margin:10px 0 8px;
    }
    .order-col{ display:grid; grid-template-rows: 1fr 1fr; gap:10px; }
    .pill-radio{
      display:flex; align-items:center; gap:10px;
      padding:12px 14px; border-radius:10px;
      background:#121212; border:1px solid #2a2a2a; color:#e5e7eb; font-weight:700;
    }
    .pill-radio input{ accent-color:#4ea1ff; transform:scale(1.1); }
    .btn-clip, .btn-submit{
      grid-row: span 2; display:flex; align-items:center; justify-content:center; text-align:center;
      border:0; border-radius:12px; cursor:pointer; font-weight:800; line-height:1.2;
      padding:0 12px; min-height:96px;
    }
    @media (min-width:900px){ .btn-clip, .btn-submit{ min-height:110px; } }
    .btn-clip{ background:#22c55e; color:#fff; font-size:16px; white-space:normal; word-break:keep-all; }
    .btn-submit{ background:#4ea1ff; color:#fff; font-size:16px; }
    .msg{ margin-top:10px; font-size:13px; color:#ccc; white-space:pre-line; min-height:1.2em; }
    details.help{ margin:10px 0 8px; }
    details.help summary{
      display:flex; align-items:center; gap:8px; cursor:pointer; user-select:none;
      font-weight:800; color:#e5e7eb; list-style:none;
    }
    details.help summary::-webkit-details-marker{ display:none; }
    .chev{ display:inline-block; transition:transform .2s ease; font-size:12px; opacity:.85; }
    details.help[open] .chev{ transform:rotate(90deg); }
    .help-body{ margin-top:8px; color:#bfc6ce; font-size:14px; line-height:1.6; }
    .group{
      border:1px solid var(--border); border-radius:12px; background:var(--bg-3);
      padding:8px; margin:8px 0; max-width:900px; margin-left:auto; margin-right:auto;
      text-align:left;
    }
    .group legend{
      padding:0 4px; font-weight:800; font-size:15px; color:#eee;
      margin-bottom:0; line-height:1.05; display:inline-flex; gap:6px; align-items:center;
    }
    .group .subnote{ font-size:12px; color:#9aa0a6; margin-left:6px; }
    .child-grid{ margin-top:0; display:grid; grid-template-columns:repeat(2, minmax(0,1fr)); gap:4px; }
    @media (min-width:900px){ .child-grid{ grid-template-columns:repeat(4, minmax(0,1fr)); } }
    .child-grid label{
      background:#0f0f0f; border:1px solid #2a2a2a; border-radius:8px;
      padding:6px 8px; font-size:14px; line-height:1.2; display:flex; gap:6px; align-items:center; justify-content:flex-start;
    }
    .rename-btn{
      margin-left:auto; font-size:12px; padding:4px 6px; border-radius:6px;
      border:1px solid #2a2a2a; background:#151515; color:#bfc6ce; cursor:pointer;
    }
    .muted{ color:#9aa0a6; font-size:12px; }
    /* 모달 최소 스타일(페이지 종속) */
    .urlfind-dialog{ border:0; border-radius:14px; padding:0; background:transparent; }
    .urlfind-dialog::backdrop{ background:rgba(0,0,0,.6); }
    .urlfind-dialog .panel{ background:#0f0f0f; color:#e5e7eb; border:1px solid #2a2a2a; border-radius:14px; padding:12px; width:min(680px, 92vw); }
    .urlfind-dialog header{ display:flex; align-items:center; justify-content:space-between; margin-bottom:8px; }
    .urlfind-dialog .panel .row{ display:flex; gap:8px; flex-wrap:wrap; margin:8px 0; }
    .urlfind-dialog input[type="text"]{ width:100%; padding:8px 10px; border:1px solid #333; border-radius:8px; background:#000; color:#fff; }
    .urlfind-dialog textarea{ width:100%; min-height:220px; padding:10px; border:1px solid #333; border-radius:8px; background:#000; color:#fff; }
    .urlfind-dialog .btn-primary{ padding:8px 12px; border-radius:10px; border:0; background:#4ea1ff; color:#fff; font-weight:800; cursor:pointer; }
    .urlfind-dialog .btn{ padding:8px 12px; border-radius:10px; border:1px solid #2a2a2a; background:#151515; color:#fff; cursor:pointer; }
    .urlfind-dialog .icon.close{ border:1px solid #2a2a2a; background:#151515; color:#ddd; border-radius:8px; padding:4px 8px; cursor:pointer; }
    .sep{ border:0; border-top:1px solid #2a2a2a; margin:6px 0; }
  </style>
</head>
<body>
  <header id="topbar">
    <div class="brand">
      <a id="brandHome" href="./" aria-label="KidsAni 홈으로">
        <img class="brand-logo" src="image/copytube_logo_side.png" alt="KidsAni"/>
      </a>
    </div>
    <div class="right" style="position:relative;">
      <a id="signupLink" class="link" href="signup.html">Sign up</a>
      <a id="signinLink" class="link" href="signin.html">Sign in</a>
      <span id="welcome" class="welcome"></span>
      <button id="menuBtn" class="icon" aria-label="menu">三</button>
      <div id="dropdownMenu" class="dropdown hidden" role="menu" aria-hidden="true">
        <button id="btnAbout" type="button">KidsAni는…</button>
        <button id="btnNick" type="button">닉네임 변경</button>
        <button id="btnMyUploads" type="button">내영상관리</button>
        <button id="btnSignOut" type="button">Sign out</button>
        <button id="btnList" type="button">영상목록</button>
        <button id="btnGoUpload" class="menu-strong" type="button">추천영상등록</button>

        <!-- ▶ 추가: Playlist URL 추출 (모달 오픈 트리거) -->
        <hr class="sep"/>
        <button id="menu-playlist-url" type="button">Playlist URL 추출</button>
      </div>
    </div>
  </header>

  <main class="intro" style="align-items:flex-start; padding-top:48px;">
    <div style="max-width:900px; width:100%; text-align:left;">
      <h2>추천영상 등록</h2>

      <label style="display:block;margin-top:14px;">YouTube 공유 URL들 (여러 줄 가능)
        <textarea id="urls" rows="3" placeholder="https://youtu.be/aaa...&#10;https://www.youtube.com/watch?v=bbb...&#10;..." style="width:100%;padding:12px;margin-top:6px;border-radius:8px;border:1px solid #333;background:#000;color:#fff;"></textarea>
      </label>

      <div class="controls-grid" id="controlsGrid">
        <div class="order-col">
          <label class="pill-radio"><input type="radio" name="order" value="bottom" checked> 아래부터 등록</label>
          <label class="pill-radio"><input type="radio" name="order" value="top"> 위부터 등록</label>
        </div>
        <button id="btnPaste" class="btn-clip" type="button" title="클립보드에서 붙여넣기">클립보드<br/>붙여넣기</button>
        <button id="btnSubmitTop" class="btn-submit" type="button">등록</button>
      </div>

      <div id="msgTop" class="msg"></div>

      <!-- 영상등록 도움말 -->
      <details class="help" id="regHelp">
        <summary><span class="chev">▶</span><span>영상등록 도움말</span></summary>
        <div class="help-body">
          • <b>URL 입력칸</b>에 직접 붙여넣거나, <b>오른쪽 “클립보드 붙여넣기”</b> 버튼을 사용하세요. (브라우저/OS 허용 필요)<br/>
          • <b>URL 다중 등록:</b> URL 입력박스에 <b>한 줄에 1개의 URL</b>을 붙여넣고, <b>카테고리 선택 후 “등록”</b>을 누르면 한 번에 모두 등록됩니다.<br/>
          • 위의 <b>“아래부터/위부터 등록”</b> 옵션으로 등록 순서를 결정합니다. (피드가 최신순이라 시리즈는 보통 <b>아래부터 등록</b>해야 차례대로 볼 수 있습니다.)<br/><br/>
          • <b>HTTPS</b> 환경에서만 동작합니다. (GitHub Pages OK)<br/>
          • <b>iPhone/iPad (iOS 16+)</b>: 처음 붙여넣기 때 <i>“이 앱에서 붙여넣기 허용”</i> 팝업에서 <b>허용</b>을 선택하세요.<br/>
          • <b>안드로이드/데스크탑 Chrome</b>: <b>설정 → 사이트 설정 → 클립보드</b>에서 사이트를 <b>허용</b>으로 변경하세요.<br/>
          • 또는 그냥, <b>길게 누르기 → 붙여넣기</b> 또는 <code>Ctrl/⌘+V</code>를 사용하면 됩니다.
        </div>
      </details>

      <p style="margin:10px 0 6px;color:#bfc6ce;">카테고리는 <b>최대 3개</b>까지 선택 가능합니다. (시리즈/개인자료는 <b>단독 등록</b>)</p>
      <div id="cats"></div>

      <button id="btnSubmitBottom" class="btn-submit" type="button" style="width:100%;margin-top:10px;min-height:56px;">등록</button>
      <div id="msg" class="msg"></div>
    </div>
  </main>

  <!-- ===== Playlist URL 추출 모달 ===== -->
  <dialog id="dlg-urlfind" class="urlfind-dialog">
    <form method="dialog" class="panel">
      <header>
        <strong>Playlist URL 추출</strong>
        <button type="submit" class="icon close" aria-label="닫기">✕</button>
      </header>

      <label class="block">
        <span>재생목록 전체 URL</span>
        <input type="text" id="uf_playlistUrl" placeholder="https://www.youtube.com/playlist?list=..." />
      </label>

      <label class="inline">
        <input type="checkbox" id="uf_useShortUrl" />
        <span>youtu.be 공유 URL 형식으로 출력</span>
      </label>

      <div class="row">
        <button type="button" id="uf_extractBtn" class="btn-primary">URL 추출 시작</button>
        <button type="button" id="uf_copyBtn" class="btn">클립보드 복사</button>
        <button type="button" id="uf_downloadBtn" class="btn">TXT 다운로드</button>
      </div>

      <div id="uf_loading" class="muted hidden">추출 중입니다...</div>
      <textarea id="uf_result" readonly placeholder="이곳에 동영상 URL 목록이 표시됩니다."></textarea>
    </form>
  </dialog>

  <!-- 로직 -->
  <script type="module" src="js/upload.js?v=0.3.0"></script>
  <!-- 모달 로직 (ES 모듈) -->
  <script type="module" src="js/urlfind.js?v=1.0"></script>
</body>
</html>
